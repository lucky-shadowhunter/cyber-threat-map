<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Cyber Threat Map</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet.js (for the map) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-XXXXXXX'); // Replace with your GTM ID
    </script>
</head>
<body class="bg-gray-900 text-white">

    <!-- GTM NoScript (for noscript users) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <div class="flex flex-col items-center justify-center h-screen">
        <h1 class="text-3xl font-bold mb-4">Live Cyber Threat Map</h1>
        <div id="map" class="w-full max-w-4xl h-96 rounded-lg shadow-lg"></div>
    </div>

    <script>
        // Initialize Leaflet.js map
        var map = L.map('map').setView([20, 0], 2); 

        // Load map tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Function to fetch threat data
        async function fetchThreatData() {
            try {
                let response = await fetch("https://threatmap-api.checkpoint.com/ThreatMap/api/feed");
                let threats = await response.json();

                threats.forEach(threat => {
                    let source = [threat.sourceLatitude, threat.sourceLongitude];
                    let destination = [threat.destinationLatitude, threat.destinationLongitude];

                    // Add markers for the source and destination
                    L.marker(source).addTo(map)
                        .bindPopup(`<b>Source: ${threat.sourceCountry}</b><br>Type: ${threat.attackType}`);

                    L.marker(destination).addTo(map)
                        .bindPopup(`<b>Destination: ${threat.destinationCountry}</b><br>Type: ${threat.attackType}`);

                    // Draw attack line
                    L.polyline([source, destination], { color: 'red' }).addTo(map);
                });

            } catch (error) {
                console.error("Error fetching threat data:", error);
            }
        }

        // Fetch new data every 10 seconds
        fetchThreatData();
        setInterval(fetchThreatData, 10000);
    </script>
</body>
</html>
